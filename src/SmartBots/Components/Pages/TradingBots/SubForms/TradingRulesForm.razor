@using SmartBots.Application.Features.TradingBots
@using SmartBots.Domain.Entities
@using SmartBots.Domain.Entities.IndicatorRules

<!-- Tables for Trading Rules -->
<div class="row">
    <!-- Bollinger Bands Rules Table -->
    <div class="col-12 mb-4">
        <h5>Bollinger Bands Rules</h5>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Period</th>
                        <th>Std Dev</th>
                        <th>Open</th>
                        <th>Close</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var rule in TradingRules.OfType<BollingerBandsRule>())
                    {
                        <tr>
                            <td>
                                <InputNumber @bind-Value="rule.Period" class="form-control form-control-sm" />
                            </td>
                            <td>
                                <InputNumber @bind-Value="rule.StandardDeviation" class="form-control form-control-sm" />
                            </td>
                            <td class="text-center">
                                <InputCheckbox @bind-Value="rule.IsUsedForOpening" class="form-check-input" />
                            </td>
                            <td class="text-center">
                                <InputCheckbox @bind-Value="rule.IsUsedForClosing" class="form-check-input" />
                            </td>
                            <td>
                                <button type="button" class="btn btn-danger btn-sm" @onclick="@(() => RemoveRule(rule))">Delete</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <!-- Add New Bollinger Bands Rule Button -->
        <button type="button" class="btn btn-outline-primary btn-sm" @onclick="AddBollingerBandsRule">
            <i class="bi bi-plus"></i> Add Bollinger Bands Rule
        </button>
    </div>

    <hr />

    <!-- MACD Rules Table -->
    <div class="col-12 mb-4">
        <h5>MACD Rules</h5>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Fast Period</th>
                        <th>Slow Period</th>
                        <th>Signal Line</th>
                        <th>Open</th>
                        <th>Close</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var rule in TradingRules.OfType<MACDRule>())
                    {
                        <tr>
                            <td>
                                <InputNumber @bind-Value="rule.FastPeriod" class="form-control form-control-sm" />
                            </td>
                            <td>
                                <InputNumber @bind-Value="rule.SlowPeriod" class="form-control form-control-sm" />
                            </td>
                            <td>
                                <InputNumber @bind-Value="rule.SignalLinePeriod" class="form-control form-control-sm" />
                            </td>
                            <td class="text-center">
                                <InputCheckbox @bind-Value="rule.IsUsedForOpening" class="form-check-input" />
                            </td>
                            <td class="text-center">
                                <InputCheckbox @bind-Value="rule.IsUsedForClosing" class="form-check-input" />
                            </td>
                            <td>
                                <button type="button" class="btn btn-danger btn-sm" @onclick="@(() => RemoveRule(rule))">Delete</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <!-- Add New MACD Rule Button -->
        <button type="button" class="btn btn-outline-primary btn-sm" @onclick="AddMACDRule">
            <i class="bi bi-plus"></i> Add MACD Rule
        </button>
    </div>

    <hr />

    <!-- RSI Rules Table -->
    <div class="col-12 mb-4">
        <h5>RSI Rules</h5>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Period</th>
                        <th>Overbought</th>
                        <th>Oversold</th>
                        <th>Open</th>
                        <th>Close</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var rule in TradingRules.OfType<RSIRule>())
                    {
                        <tr>
                            <td>
                                <InputNumber @bind-Value="rule.Period" class="form-control form-control-sm" />
                            </td>
                            <td>
                                <InputNumber @bind-Value="rule.OverboughtThreshold" class="form-control form-control-sm" />
                            </td>
                            <td>
                                <InputNumber @bind-Value="rule.OversoldThreshold" class="form-control form-control-sm" />
                            </td>
                            <td class="text-center">
                                <InputCheckbox @bind-Value="rule.IsUsedForOpening" class="form-check-input" />
                            </td>
                            <td class="text-center">
                                <InputCheckbox @bind-Value="rule.IsUsedForClosing" class="form-check-input" />
                            </td>
                            <td>
                                <button type="button" class="btn btn-danger btn-sm" @onclick="@(() => RemoveRule(rule))">Delete</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <!-- Add New RSI Rule Button -->
        <button type="button" class="btn btn-outline-primary btn-sm" @onclick="AddRSIRule">
            <i class="bi bi-plus"></i> Add RSI Rule
        </button>
    </div>
</div>



@code {
    [Parameter] public List<TradingRule> TradingRules { get; set; }

    private void AddBollingerBandsRule() => TradingRules.Add(new BollingerBandsRule { Period = 20, StandardDeviation = 2.0 });
    private void AddMACDRule() => TradingRules.Add(new MACDRule { FastPeriod = 12, SlowPeriod = 26, SignalLinePeriod = 9 });
    private void AddRSIRule() => TradingRules.Add(new RSIRule { Period = 14, OverboughtThreshold = 70, OversoldThreshold = 30 });

    private void RemoveRule(TradingRule rule) => TradingRules.Remove(rule);
}
